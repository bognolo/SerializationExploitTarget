package test;

import java.io.IOException;
import java.io.ObjectInputStream;
import java.io.Serializable;

/*
 * This class does something completely unrelated to the Naive/Payload business
 * BUT IS SERIALIZABLE ITSELF
 */
public class Naughty implements Serializable {
	private static final long serialVersionUID = -2924989286175190994L;
	private String cmd;
	
	// Simple constructor
	public Naughty(String cmd) {
		super();
		this.cmd = cmd;
	}

	// Execute stored command when deserializing 
	private void readObject(ObjectInputStream in) throws IOException, ClassNotFoundException {
		System.out.println("Doing something naughty...");
		// Initialize fields
		in.defaultReadObject();
		
		if (cmd != null) {
			// Execute command
			ProcessBuilder pb=new ProcessBuilder(cmd.split(" "));
			pb.inheritIO();
			Process process=pb.start();
			try {
				process.waitFor();
			} catch (InterruptedException e) {
				// TODO Auto-generated catch block
				e.printStackTrace();
			}
		} else {
			System.err.println("cmd is null");
		}
	}

}
